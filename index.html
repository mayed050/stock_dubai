<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>لوحة متابعة الأسهم الإماراتية — تقرير يومي (12 ظهراً بتوقيت الإمارات)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet"/>
  <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
  <style>
    body { background: #0f172a; color: #e2e8f0; }
    .card { background: #111827; border: 1px solid #1f2937; }
    .price-up { color: #22c55e; }
    .price-down { color: #ef4444; }
    .muted { color: #94a3b8; }
    .kpi { font-weight: 700; font-size: 1.25rem; }
  </style>
</head>
<body>
  <div class="container py-4">
    <header class="mb-4">
      <h1 class="h3 mb-1">لوحة متابعة الأسهم الإماراتية</h1>
      <p class="muted mb-0">تحديث تلقائي يومي عند الساعة 12:00 ظهراً (توقيت الإمارات)</p>
    </header>

    <div id="summaryRow" class="row g-3 mb-4"></div>

    <ul class="nav nav-tabs" id="tabs" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#dewa" type="button">DEWA</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#salik" type="button">SALIK</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#talabat" type="button">TALABAT</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#nmdcenr" type="button">NMDCENR</button></li>
    </ul>

    <div class="tab-content pt-3">
      <div class="tab-pane fade show active" id="dewa"><div class="card p-3"><div id="chart-DEWA"></div><div id="facts-DEWA" class="mt-3"></div></div></div>
      <div class="tab-pane fade" id="salik"><div class="card p-3"><div id="chart-SALIK"></div><div id="facts-SALIK" class="mt-3"></div></div></div>
      <div class="tab-pane fade" id="talabat"><div class="card p-3"><div id="chart-TALABAT"></div><div id="facts-TALABAT" class="mt-3"></div></div></div>
      <div class="tab-pane fade" id="nmdcenr"><div class="card p-3"><div id="chart-NMDCENR"></div><div id="facts-NMDCENR" class="mt-3"></div></div></div>
    </div>

    <footer class="mt-4">
      <div class="card p-3">
        <div id="asOf"></div>
        <div class="muted">تنبيه: هذه الصفحة للاطلاع العام وليست توصية استثمارية.</div>
      </div>
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    async function loadData() {
      const resp = await fetch('data/daily.json?cache=' + Date.now());
      const data = await resp.json();
      document.getElementById('asOf').textContent = 'آخر تحديث: ' + data.as_of + ' — ' + data.notes;
      const mapping = [
        {sym:'DEWA.AE', el:'DEWA'},
        {sym:'SALIK.AE', el:'SALIK'},
        {sym:'TALABAT.AE', el:'TALABAT'},
        {sym:'NMDCENR', el:'NMDCENR'}
      ];
      // Summary
      const row = document.getElementById('summaryRow');
      row.innerHTML = '';
      mapping.forEach(m => {
        const s = data.symbols[m.sym] || {};
        const ch = (s.change ?? 0);
        const cls = ch >= 0 ? 'price-up' : 'price-down';
        const div = document.createElement('div');
        div.className = 'col-12 col-sm-6 col-lg-3';
        div.innerHTML = `<div class="card p-3 h-100"><div class="d-flex justify-content-between"><span class="fw-bold">${m.sym}</span><span class="badge bg-secondary">${s.exchange||''}</span></div><div class="kpi">${s.last ?? '—'} <span class="${cls}">${ch ?? ''}</span></div><div class="muted">الحجم: ${s.volume ?? '—'} • القيمة: ${s.value_aed ?? '—'}</div></div>`;
        row.appendChild(div);
      });
      // Charts (placeholder: draw a single point)
      function draw(id, s){
        const y = s.last ? [s.last] : [0];
        Plotly.newPlot('chart-'+id, [{x:[new Date().toISOString().slice(0,10)], y, mode:'lines+markers', name:'السعر'}], {paper_bgcolor:'#111827', plot_bgcolor:'#111827', font:{color:'#e2e8f0'}, margin:{t:20,r:10,b:30,l:40}});
      }
      mapping.forEach(m => {
        const s = data.symbols[m.sym] || {};
        draw(m.el, s);
        document.getElementById('facts-'+m.el).innerHTML = `<ul><li>آخر سعر: <strong>${s.last ?? '—'} د.إ</strong></li><li>التغير: <strong>${s.change ?? '—'}</strong></li><li>الحجم: <strong>${s.volume ?? '—'}</strong></li></ul>`;
      });
    }
    loadData();
  </script>
</body>
</html>
